<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RÂ³ â€” Calculadora Vetorial Completa</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>

  <body>
    <header>
      <h1>RÂ³ â€” Calculadora Vetorial</h1>
      <p>Visualize e compreenda operaÃ§Ãµes vetoriais no espaÃ§o tridimensional</p>
    </header>

    <main>
      <section class="card input-area">
        <h2>ğŸ”¢ Entradas dos Vetores</h2>
        <form id="form">
          <div class="vetor-group">
            <h3>Vetor vâ‚ (u)</h3>
            <input name="v1x" type="number" placeholder="xâ‚">
            <input name="v1y" type="number" placeholder="yâ‚">
            <input name="v1z" type="number" placeholder="zâ‚">
          </div>

          <div class="vetor-group">
            <h3>Vetor vâ‚‚ (v)</h3>
            <input name="v2x" type="number" placeholder="xâ‚‚">
            <input name="v2y" type="number" placeholder="yâ‚‚">
            <input name="v2z" type="number" placeholder="zâ‚‚">
          </div>

          <div class="vetor-group">
            <h3>Vetor vâ‚ƒ (w) â€” Produto Misto</h3>
            <input name="v3x" type="number" placeholder="xâ‚ƒ">
            <input name="v3y" type="number" placeholder="yâ‚ƒ">
            <input name="v3z" type="number" placeholder="zâ‚ƒ">
            <p class="hint">Dica: se deixar vâ‚ƒ vazio, ele serÃ¡ kÂ·vâ‚‚</p>
          </div>

          <div class="vetor-group">
            <h3>Escalar k</h3>
            <input name="escalar" type="number" placeholder="k">
          </div>

          <div class="buttons">
            <button type="button" onclick="enviar('soma')">â• Soma (vâ‚ + vâ‚‚)</button>
            <button type="button" onclick="enviar('multiplicacao_escalar')">âš™ï¸ kÂ·vâ‚</button>
            <button type="button" onclick="enviar('produto_escalar')">ğŸ”¸ Produto Escalar</button>
            <button type="button" onclick="enviar('produto_vetorial')">âœ–ï¸ Produto Vetorial</button>
            <button type="button" onclick="enviar('produto_misto')">ğŸ“ Produto Misto</button>
            <button type="button" class="secondary" onclick="gerarGrafico()">ğŸ§­ Mostrar GrÃ¡fico 3D</button>
          </div>
        </form>
      </section>

      <section class="card">
        <h2>ğŸ“˜ Passo a passo</h2>
        <pre id="passos">Insira os vetores e escolha uma operaÃ§Ã£o acima.</pre>
      </section>

      <section class="card">
        <h2>ğŸ’¡ Resultado Final</h2>
        <p id="resultado">â€”</p>
      </section>

      <section class="card">
        <h2>ğŸ§® RepresentaÃ§Ã£o GrÃ¡fica 3D</h2>
        <div id="grafico"></div>
      </section>
    </main>

    <footer>
      <p>Desenvolvido por Geovanna Kamila Souza de Oliveira</p>
    </footer>

    <script>
      async function enviar(tipo) {
        const form = document.getElementById("form");
        const fd = new FormData(form);
        fd.append("tipo", tipo);

        const res = await fetch("/operacao", { method: "POST", body: fd });
        const data = await res.json();

        document.getElementById("passos").textContent = data.passos || "â€”";
        document.getElementById("resultado").textContent =
          Array.isArray(data.resultado)
            ? `(${data.resultado.map(n => fmt(n)).join(", ")})`
            : (data.resultado ?? "â€”");
      }

      function fmt(x) {
        if (x === null || x === undefined) return "0";
        const i = Math.trunc(x);
        return Math.abs(x - i) < 1e-12 ? String(i) : Number(x).toFixed(3).replace(/\.?0+$/,"");
      }

      function getVal(name) {
        const v = parseFloat(document.querySelector(`[name="${name}"]`).value);
        return isNaN(v) ? 0 : v;
      }

      function gerarGrafico() {
        const v1 = [getVal("v1x"), getVal("v1y"), getVal("v1z")];
        const v2 = [getVal("v2x"), getVal("v2y"), getVal("v2z")];
        const v3 = [getVal("v3x"), getVal("v3y"), getVal("v3z")];

        const traces = [];

        const cores = ["#9f67ff", "#47a3ff", "#4ef09a"];
        const nomes = ["vâ‚", "vâ‚‚", "vâ‚ƒ"];
        const vetores = [v1, v2, v3];

        vetores.forEach((v, i) => {
          if (Math.abs(v[0])+Math.abs(v[1])+Math.abs(v[2])>0){
            traces.push({
              x: [0, v[0]],
              y: [0, v[1]],
              z: [0, v[2]],
              type: "scatter3d",
              mode: "lines+markers+text",
              line: { color: cores[i], width: 6 },
              marker: { size: 5, color: cores[i] },
              text: [null, nomes[i]],
              textposition: "top center",
              name: nomes[i]
            });
          }
        });

        Plotly.newPlot("grafico", traces, {
          scene: {
            xaxis:{title:"Eixo X"},
            yaxis:{title:"Eixo Y"},
            zaxis:{title:"Eixo Z"},
            aspectmode: "cube"
          },
          paper_bgcolor:"#15151a",
          plot_bgcolor:"#15151a",
          font:{color:"#fff"},
          margin:{l:0,r:0,t:0,b:0}
        });
      }
    </script>
  </body>
</html>
