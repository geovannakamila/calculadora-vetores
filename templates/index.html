<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>R³ — Operações com Vetores</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    <header>
      <h1>R³ — Operações com Vetores</h1>
      <p>Adição • Produto Escalar • Produto Vetorial • Multiplicação por Escalar • Produto Misto</p>
    </header>

    <main>
      <section class="card">
        <form id="form">
          <div class="row">
            <div class="col">
              <h3>Vetor u (v₁)</h3>
              <div class="inputs">
                <input name="v1x" type="number" placeholder="x₁">
                <input name="v1y" type="number" placeholder="y₁">
                <input name="v1z" type="number" placeholder="z₁">
              </div>
            </div>
            <div class="col">
              <h3>Vetor v (v₂)</h3>
              <div class="inputs">
                <input name="v2x" type="number" placeholder="x₂">
                <input name="v2y" type="number" placeholder="y₂">
                <input name="v2z" type="number" placeholder="z₂">
              </div>
            </div>
            <div class="col">
              <h3>Vetor w (v₃) (para produto misto)</h3>
              <div class="inputs">
                <input name="v3x" type="number" placeholder="x₃">
                <input name="v3y" type="number" placeholder="y₃">
                <input name="v3z" type="number" placeholder="z₃">
              </div>
              <p class="hint">Se não informar v₃, posso usar w = k·v₂ (preencha k).</p>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <h3>Escalar k</h3>
              <div class="inputs">
                <input name="escalar" type="number" placeholder="k">
              </div>
            </div>
          </div>

          <div class="buttons">
            <button type="button" onclick="enviar('soma')">Somar (v₁ + v₂)</button>
            <button type="button" onclick="enviar('multiplicacao_escalar')">k · v₁</button>
            <button type="button" onclick="enviar('produto_escalar')">Produto Escalar (v₁·v₂)</button>
            <button type="button" onclick="enviar('produto_vetorial')">Produto Vetorial (v₁×v₂)</button>
            <button type="button" onclick="enviar('produto_misto')">Produto Misto [v₁,v₂,v₃]</button>
            <button type="button" class="secondary" onclick="gerarGrafico()">Gerar Gráfico 3D</button>
          </div>
        </form>
      </section>

      <section class="card">
        <h3>Passo a passo</h3>
        <pre id="passos">—</pre>
        <h3>Resultado</h3>
        <p id="resultado">—</p>
      </section>

      <section class="card">
        <h3>Gráfico Vetorial 3D</h3>
        <div id="grafico"></div>
        <div class="legend-hint">Ploto v₁, v₂ e v₃ (se informado). Para operações, os vetores são tomados a partir da origem.</div>
      </section>
    </main>

    <script>
      async function enviar(tipo) {
        const form = document.getElementById("form");
        const fd = new FormData(form);
        fd.append("tipo", tipo);

        const res = await fetch("/operacao", { method: "POST", body: fd });
        const data = await res.json();

        document.getElementById("passos").textContent = data.passos || "—";
        document.getElementById("resultado").textContent =
          (Array.isArray(data.resultado) ? `(${data.resultado.map(n => typeof n === "number" ? fmt(n) : n).join(", ")})` :
           (data.resultado ?? "—"));
      }

      function fmt(x) {
        if (x === null || x === undefined) return "0";
        const i = Math.trunc(x);
        return Math.abs(x - i) < 1e-12 ? String(i) : Number(x).toFixed(4).replace(/\.?0+$/,"");
      }

      function getVal(name) {
        const v = parseFloat(document.querySelector(`[name="${name}"]`).value);
        return isNaN(v) ? 0 : v;
        }

      function gerarGrafico() {
        const v1 = [getVal("v1x"), getVal("v1y"), getVal("v1z")];
        const v2 = [getVal("v2x"), getVal("v2y"), getVal("v2z")];
        const v3 = [getVal("v3x"), getVal("v3y"), getVal("v3z")];

        const traces = [];

        function addVec(v, nome) {
          traces.push({
            x: [0, v[0]], y: [0, v[1]], z: [0, v[2]],
            type: "scatter3d", mode: "lines+markers",
            line: { width: 6 }, name: nome
          });
        }

        addVec(v1, "v₁");
        addVec(v2, "v₂");
        if (Math.abs(v3[0]) + Math.abs(v3[1]) + Math.abs(v3[2]) > 0) addVec(v3, "v₃");

        Plotly.newPlot("grafico", traces, {
          scene: { xaxis:{title:"X"}, yaxis:{title:"Y"}, zaxis:{title:"Z"} },
          margin: {l:0, r:0, t:0, b:0},
          paper_bgcolor:"#15151a", font:{color:"#fff"}
        }, {displaylogo:false});
      }
    </script>
  </body>
</html>
